
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<!-- <link rel="shortcut icon" href="../../assets/ico/favicon.png"> -->

	<title>079: n-Queens Completion Problem and Excluded Diagonals n-Queens Problem</title>

	<!-- Bootstrap core CSS -->
	<link href="/bootstrap/css/bootstrap.css" rel="stylesheet">

	<link href="/css/main.css" rel="stylesheet">
	<script src="/js/jquery.min.js" ></script>

	<!-- Enable table sorting -->
	<script src="/js/tablesorter/jquery.tablesorter.min.js"></script>
	<link rel="stylesheet" href="/js/tablesorter/blue/style.css" type="text/css"/>
	<script type="text/javascript">
	$(function() {
		$(".tablesorter").tablesorter();
	});
	</script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML.js">
	MathJax.Hub.Config({
	  	tex2jax: {
	    inlineMath: [['$','$'], ['\\(','\\)']],
	    processEscapes: true
	  	}
	});
	</script>

  
	<link type="text/css" rel="stylesheet" href="/syntax_highlighter/shCoreDefault.css"/>

</head>

<body>

	<ol class="breadcrumb">
    	  <li><a href="/">CSPLib</a></li>

  <li><a href="/Problems">Problems</a></li>
  <li><a href="/Problems/prob079">prob079</a></li>

  <li><a href="/Problems/prob079/models">Models</a></li>
  <li>shiftqueens-128.cc</li>
	</ol>

	<div class="container">

		<div class="page-header">
			<h1>079: n-Queens Completion Problem and Excluded Diagonals n-Queens Problem</h1>


<!-- macro to Not made a link if on the page the link links to -->


<header class="nav-header">
<div class="nav-container">
  <nav class="nav">
  <ul>
     	<li><a href="/Problems/prob079/">Specification</a></li>

     	<li><a href="/Problems/prob079/data">Data files</a></li>

     	<li><a href="/Problems/prob079/results">Results</a></li>

     	<li><a href="/Problems/prob079/references">References</a></li>

     	<li><a href="/Problems/prob079/models">Models</a></li>

     	<li><a href="/Problems/prob079/cite">Cite</a></li>

    <li><a href="/Problems/prob079.json" >Json</a></li>

    <li style="float:right"><a href="https://github.com/csplib/csplib/blob/master/Problems/prob079/models/shiftqueens-128.cc">Edit Page</a></li>
  </ul>
  </nav>
</div>
</header>


		</div>


<a href="/Problems/prob079/models/shiftqueens-128.cc">Download</a>
<pre class ='brush: cc'>// The MIT License (MIT)
// 
// Copyright (c) 2015 Christopher Jefferson
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;
#include &lt;iostream&gt;
#include &lt;signal.h&gt;


//#define PRINT_INFO

#ifdef PRINT_INFO
#define INFO(...) printf(__VA_ARGS__);
#define PAD(x) pad(x);
#define PRINTBITS(x) printBits(x)
#else
#define INFO(...)
#define PAD(x)
#define PRINTBITS(x)
#endif

#define PRINT_SOL

#ifdef PRINT_SOL
static int sol[100];
#endif

#include &lt;sys/resource.h&gt;
#include &lt;sys/times.h&gt;

double gettime() {
	struct rusage rusage;
	if ( getrusage( RUSAGE_SELF, &amp;rusage ) != -1 )
		return (double)rusage.ru_utime.tv_sec +
			(double)rusage.ru_utime.tv_usec / 1000000.0;
	
	std::cerr &lt;&lt; "Fatal error in reading time\n";
	exit(1);
}

volatile int trig = false;

void trigger_function(int /* signum */) {
  trig = true;
}

void setup_timelimit(int timeout) {
	signal(SIGXCPU, trigger_function);
	signal(SIGALRM, trigger_function);
	rlimit lim;
	lim.rlim_cur = timeout;
	lim.rlim_max = timeout + 5;
	setrlimit(RLIMIT_CPU, &amp;lim);
}

long long node_count = 0;

static __int128_t all;
static const __int128_t one = 1;
static int depth;
static int count = 0;

int fillLeft[127];
int fillRight[127];
int skipDepth[127];

#ifdef PRINT_SOL
void print_sol()
{
	for(int i = 0; i &lt; depth; ++i)
	{
		if(skipDepth[i])
			printf("-");
		else
			printf("|");
		for(int j = 0; j &lt; depth; ++j)
		{
			if(1&lt;&lt;j == sol[i])
				printf("#|");
			else
			  printf(" |");
		}
		printf("\n");
		for(int j = 0; j &lt; depth; ++j)
		printf("--");
		printf("-\n");
	}
	printf("\n");
}
#endif

void printBits(__int128_t bits)
{
	for(int i = 0; i &lt; depth; ++i) {
		printf(bits &amp; one ? "1" : "0");
		bits = bits &gt;&gt; 1;
	}
}

void pad(int curDepth)
{ 
		for(int i=0; i &lt; curDepth; ++i)
			printf(" ");
}

void print_info() {
        std::cout &lt;&lt; "Solutions: " &lt;&lt; count &lt;&lt; " ";
        std::cout &lt;&lt; "Nodes: " &lt;&lt; node_count &lt;&lt; " ";
        std::cout &lt;&lt; "Timeout: " &lt;&lt; trig &lt;&lt; " ";
        std::cout &lt;&lt; "Time: " &lt;&lt; gettime() &lt;&lt; "\n";
}


void tryFunc(__int128_t ld, __int128_t cols, __int128_t rd, int curDepth)
{
		node_count++;
		if(trig) {
			print_info();
			std::cout &lt;&lt; "Timeout Reached. Exiting.\n";
			exit(0);
		}
		PAD(curDepth);
		PRINTBITS(ld);
		INFO(",");
		PRINTBITS(cols);
		INFO(",");
		PRINTBITS(rd);
		INFO(":%d ", curDepth);
	if(curDepth == depth)
	{
		INFO("\n");
		count++;
		std::cout &lt;&lt; "Solution Found\n";
#ifdef PRINT_SOL
		print_sol();
#endif
		print_info();
		
		exit(0);
	}

	__int128_t shiftld = ld &lt;&lt; 1;
	__int128_t shiftrd = rd &gt;&gt; 1;
	
	assert((shiftld &amp; one) == 0);
	assert((shiftrd &amp; (one &lt;&lt; (depth - 1))) == 0);
	
	if(fillLeft[curDepth+1])
	{
		INFO("*");
		shiftld |= one;
	}
	else
	INFO(" ");
	
	if(fillRight[curDepth+1])
	{
		INFO("*");
		shiftrd |= one &lt;&lt; (depth - 1);
	}
	else INFO(" ");
	
	// If we already put a queen on this depth, skip it.
	if(skipDepth[curDepth])
	{
		INFO(" -- skip\n");
		return tryFunc(shiftld, cols, shiftrd, curDepth + 1);
	}
	
	PRINTBITS(shiftld);
		INFO(",");
		PRINTBITS(shiftrd);
		INFO("\n");
		
	{
		__int128_t poss = ~(ld | cols | rd) &amp; all;
		while(poss) {
			__int128_t bit = poss &amp; -poss;
			poss -= bit;
#ifdef PRINT_SOL
			sol[curDepth] = bit;
#endif
			PAD(curDepth);
			PRINTBITS(bit);
			INFO(" added\n");
			tryFunc((bit&lt;&lt;1)|shiftld, cols|bit, (bit&gt;&gt;1)|shiftrd, curDepth + 1);
		}
	}
}

int main(int argc, char** argv)
{
	// SETUP TIMELIMIT HERE
	setup_timelimit(1800);
	
	if(argc % 2 != 0)
	{
		printf("./shiftqueens-128 n queen1x queen1y queen2x queen2y ...\n");
		exit(1);
	}
	
	depth = atoi(argv[1]);
	
	if(depth&gt;127) {
	    printf("n is limited to a maximum of 127 in this version of shiftqueens.\n");
		exit(1);
	}
	
	all = (one &lt;&lt; depth) - 1;
	
	__int128_t cols = 0;
	__int128_t ld = 0;
	__int128_t rd = 0;
	
	printf("%d\n", argc);
	
	for(int i = 2; i &lt; argc; i+=2)
	{
		int queenx = atoi(argv[i]);
		int queeny = atoi(argv[i+1]);
		printf("%d,%d\n", queenx, queeny);
		
		if(skipDepth[queeny]) {
			printf("inconsistent y\n");
			exit(1);
		}
		
		skipDepth[queeny] = 1;
#ifdef PRINT_SOL
		sol[queeny] = one &lt;&lt; queenx;
#endif

		__int128_t colpos = one &lt;&lt; queenx;
		if(cols &amp; colpos) {
			printf("Inconsistent start\n");
			exit(1);
		}
		cols |= colpos;
		
		{
			int rightintersect = queenx + queeny;
			if(rightintersect &lt; depth)
			{
				__int128_t newrd = one &lt;&lt; rightintersect;
				if(rd &amp; newrd) {
					printf("inconsistent diagonal\n");
					exit(1);
				}
				rd |= newrd;
			}
			else
			{
					rightintersect -= (depth - 1);
					if(fillRight[rightintersect]) {
						printf("inconsistent diagonal - type 2\n");
						exit(1);
					}
					fillRight[rightintersect] = 1;
			}
		}
	
		{
			int leftintersect = queenx - queeny;
			if(leftintersect &gt;= 0)
			{
				__int128_t newld = one &lt;&lt; leftintersect;
				if(ld &amp; newld) {
					printf("inconsistent left diagonal\n");
					exit(1);
				}
				ld |= newld;
			}
			else
			{
					leftintersect *= -1;
					if(fillLeft[leftintersect]) {
						printf("inconsistent left diagonal - type 2\n");
						exit(1);
					}
					fillLeft[leftintersect] = 1;
			}
		}
}

	
	count = 0;
	tryFunc(ld, cols, rd, 0);
	std::cout &lt;&lt; "No solution" &lt;&lt; "\n";
	print_info();
	exit(0);
}

</pre>


	</div>


<!-- Syntax highlighter  -->
<script type="text/javascript" src="/syntax_highlighter/shCore.js"></script>
<script type="text/javascript" src="/syntax_highlighter/shAutoloader.js" ></script>
<script type="text/javascript">
    SyntaxHighlighter.autoloader(

    // Languages that have a language page in csplib
    // Only the Title from specification.md converted to lower case should be used.
    ['comet',        '/js/shBrushComet.js'],
    ['eclipse',      '/js/shBrushECLiPSe.js'],
    ['essence',      '/js/shBrushEssence.js'],
    ['essenceprime', '/js/shBrushEssencePrime.js'],
    ['minizinc',     '/js/shBrushMiniZinc.js'],


    // Standard Programming languages
    ['cpp','hpp','hh','cc','h','c', '/syntax_highlighter/shBrushCpp.js'],
    ['erl','hrl', '/syntax_highlighter/shBrushErlang.js'] ,
    ['cs'       , '/syntax_highlighter/shBrushCSharp.js'] ,
    ['groovy'   , '/syntax_highlighter/shBrushGroovy.js'] ,
    ['java'     , '/syntax_highlighter/shBrushJava.js']   ,
    ['js'       , '/syntax_highlighter/shBrushJScript.js'],
    ['php'      , '/syntax_highlighter/shBrushPhp.js']    ,
    ['pl'       , '/syntax_highlighter/shBrushPerl.js']   ,
    ['py'       , '/syntax_highlighter/shBrushPython.js'] ,
    ['rb'       , '/syntax_highlighter/shBrushRuby.js']   ,
    ['scala'    , '/syntax_highlighter/shBrushScala.js']  ,
    ['xml'      , '/syntax_highlighter/shBrushXml.js']
 	);

	SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


</div>

<div id="footer">

    <center><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. </center>

</div>
  <!-- float footer to bottom of page -->
  <script>

    $(document).ready(function() {

     var docHeight = $(window).height();
     var footerHeight = $('#footer').height();
     var footerTop = $('#footer').position().top + footerHeight;

     if (footerTop + 20 < docHeight) {
      $('#footer').css('margin-top',  (docHeight - (footerTop + 20)) + 'px');
     }
    });
   </script>
</body>

</html>